<!--TO READ THIS HELP FILE, RIGHT-CLICK ON THE FILE NAME IN THE
    SOLUTION EXPLORER PANE AND SELECT "VIEW IN BROWSER"-->

<html><head><title>Hotswap Sample: Replacing ATL Server Application DLLs at Run Time</title></head><body><h1>Hotswap Sample: Replacing ATL Server Application DLLs at Run Time</h1><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()"></div><p /><p>Demonstrates how to replace ATL Server Web application DLLs at run time without losing requests.</p><p>When running this sample, use your favorite Web stress tool to verify that no requests are lost. The most that should happen is a small delay while the swap actually occurs.</p><p>Note that this mechanism only works for simple application DLLs. It relies on the fact that the DLL can be unloaded if no threads from the ATL Server thread pool are within a call to <b>DispatchStencilCall</b>. If your application DLL increments its reference count by registering a service with the ISAPI extension (through <b>IServiceProvider</b>), creates a secondary thread pool, or uses asynchronous processing, extra work will be required in <code>CSwapExtension::StopRequests</code> to negotiate the proper shutdown of the application DLL.</p><p>Additionally, this sample does not restrict who is allowed to request a swap. When using this mechanism, it is highly recommended that some form of role-based access check be performed.</p><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left">Security Note </th></tr><tr><td><p>This sample code is provided to illustrate a concept and should not be used in applications or Web sites, as it may not illustrate the safest coding practices.</p></td></tr></table></div><h1 class="heading">Requirements</h1><div id="requirementsSection" class="section"><ul><li><p>IIS</p></li></ul></div><h1 class="heading">Building and Running the Sample</h1><div id="sectionSection0" class="seeAlsoNoToggleSection"><h4 class="subHeading">To build and run this sample</h4><div class="subSection"><ol><li><p>Open the solution file, HotSwap.sln, in the Visual Studio development environment.</p></li><li><p>Build the solution. This will also deploy the solution to the local Web server.</p></li><li><p>Use a Web browser to view http://localhost/hotswap/hotswaptest.srf. You should see a simple greeting.</p></li><li><p>Edit the code in <code>OnHello</code> in hotswaptest.h to change the greeting.</p></li><li><p>Change the link settings for the HotswapTest project to output the DLL as hotswaptest.dll.new and rebuild that project. This will also deploy the new DLL to the local Web server.</p></li><li><p>Use a Web browser to view http://localhost/hotswap/hotswapadmin.srf.</p></li><li><p>Enter the full paths of the original and new hotswaptest.dll files. For example, they might be: </p><ul><li><p>Target: C:\Inetpub\wwwroot\hotswap\hotswaptest.dll</p></li><li><p>Source: C:\Inetpub\wwwroot\hotswap\hotswaptest.dll.new</p></li></ul></li><li><p>Click the <b>swap files</b> button on the page.</p></li><li><p>Use a Web browser to view http://localhost/hotswap/hotswaptest.srf. You should see the greeting modified in Step 4.</p></li></ol></div><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left">Note </th></tr><tr><td><p>You will probably need to modify the security settings of the DLLs in the file system or of the virtual directory to enable copying to take place.</p></td></tr></table></div><sections ><h4 class="subHeading" xmlns="">Demonstrates</h4><div class="subSection" xmlns=""><p><MSHelp:link keywords="4E58D047-42BB-451D-A0B1-5BDA65ABF93B" tabindex="0" >CDllCache::Flush</MSHelp:link> | <MSHelp:link keywords="2E4D3A62-E192-4107-A2B7-6D03DFA2E11D" tabindex="0" >CIsapiExtension</MSHelp:link> | <MSHelp:link keywords="11694B93-A4F1-4783-9B71-ABAA56E6EC6F" tabindex="0" >CIsapiExtension::DispatchStencilCall</MSHelp:link> | <MSHelp:link keywords="CF629CFB-BEFE-4045-9AA3-4AB771D92BD1" tabindex="0" >CIsapiExtension::GetExtensionVersion</MSHelp:link> | <MSHelp:link keywords="2A07416D-048E-44CF-8902-A5C823D191D9" tabindex="0" >CIsapiExtension::m_DllCache</MSHelp:link> | <MSHelp:link keywords="D3FDA700-7152-4428-937A-BC416A3FFDC2" tabindex="0" >CIsapiExtension::m_StencilCache</MSHelp:link> | <MSHelp:link keywords="A3F871B8-B028-4A08-B4FE-28A3418349FC" tabindex="0" >CIsapiExtension::TerminateExtension</MSHelp:link> | <MSHelp:link keywords="91F83C79-FF12-4414-9571-758437E098B6" tabindex="0" >CStencilCache::RemoveAllStencils</MSHelp:link></p></div></sections></div></div><div id="footer"><div class="footerLine"></div>
          © Microsoft Corporation. All rights reserved.  Send <a href="mailto:DevDocs@microsoft.com?subject=Documentation Feedback :Hotswap Sample: Replacing ATL Server Application DLLs at Run Time">comments</a> about this topic to Microsoft.
      </div></div></body></html>
